[toc]

```java
class Solution {
    int[] delta = new int[]{-2, 1, -2, -1, 2, 1, 2, -1, -2};

    public double knightProbability(int N, int K, int r, int c) {
        // 记录保存在棋盘内的数目
        double[][][] dp = new double[N][N][K + 1];
        // 在起始位置的概率
        dp[r][c][0] = 1.0D;

        for (int k = 0; k < K; k++) {
            for (int i = 0; i < N; i++) {
                for (int j = 0; j < N; j++) {
                    if (dp[i][j][k] == 0) continue;

                    for (int l = 0; l < 8; l++) {
                        int x = i + delta[l], y = j + delta[l + 1];
                        if (x < 0 || y < 0 || x >= N || y >= N) continue;

                        dp[x][y][k + 1] += dp[i][j][k] / 8;
                    }
                }
            }
        }
        double p = 0;
        for (int i = 0; i < N; i++) {
            for (int j = 0; j < N; j++) {
                p += dp[i][j][K];
            }
        }

        return p;
    }
}
```



```java
class Solution {
    int[] delta = new int[]{-2, 1, -2, -1, 2, 1, 2, -1, -2};

    public double knightProbability(int N, int K, int r, int c) {
        // 记录保存在棋盘内的数目
        double[][] dp = new double[N][N];
        // 在起始位置的概率
        dp[r][c] = 1.0D;

        for (int k = 0; k < K; k++) {
            double[][] temp = new double[N][N];
            for (int i = 0; i < N; i++) {
                for (int j = 0; j < N; j++) {
                    if (dp[i][j] == 0) continue;

                    for (int l = 0; l < 8; l++) {
                        int x = i + delta[l], y = j + delta[l + 1];
                        if (x < 0 || y < 0 || x >= N || y >= N) continue;

                        temp[x][y] += dp[i][j] / 8;
                    }
                }
            }
            dp = temp;
        }
        double p = 0;
        for (int i = 0; i < N; i++) {
            for (int j = 0; j < N; j++) {
                p += dp[i][j];
            }
        }

        return p;
    }
}
```

