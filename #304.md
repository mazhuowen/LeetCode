[toc]

```java
class NumMatrix {
    int m, n;
    int[][] preSum;

    public NumMatrix(int[][] matrix) {
        if (matrix == null || matrix.length == 0 || matrix[0].length == 0) {
            this.m = -1;
            this.n = -1;
            return;
        }
        this.m = matrix.length;
        this.n = matrix[0].length;
        preSum = new int[m + 1][n + 1];
        int[] rowSum = new int[n + 1];
        for (int i = 0; i < m; i++) {
            for (int j = 0; j < n; j++) {
                rowSum[j + 1] = rowSum[j] + matrix[i][j];
                preSum[i + 1][j + 1] = preSum[i][j + 1] + rowSum[j] + matrix[i][j];
            }
        }
    }

    public int sumRegion(int row1, int col1, int row2, int col2) {
        if (row1 >= m || row1 < 0 || row2 >= m || row2 < 0) return 0;
        if (col1 >= n || col1 < 0 || col2 >= n || col2 < 0) return 0;
        return preSum[row2 + 1][col2 + 1] - preSum[row2 + 1][col1] - preSum[row1][col2 + 1] + preSum[row1][col1];
    }
}
```
